<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Smart Doorbell using RPi with voice and email notification.</title>

  <meta name="author" content="Mpho Mphego" />
  <meta name="theme-color" content="#a50509">
  <meta name="description" content="Hi! I'm Mpho Mphego, a programmer, software developer. Loves to meet new people, connect, discuss, network and grow, mostly at software developers’ conferences, dev-fests and gaming meet-ups.">
  <meta name="keywords" content="Mpho , geek, linux, science, math, mathematics, raspberry pi, music, Internet of Things, research, android, ubuntu, python, docker">

  <!-- favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />

  <!-- MathJax -->
  <script type="text/x-mathjax-config">MathJax.Hub.Config({messageStyle: 'none',tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  <link rel="alternate" type="application/rss+xml" title="Mpho Mphego - Welcome to the geek side!" href="/feed.xml" />

  

  
    
      
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />

    
  

  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="Smart Doorbell using RPi with voice and email notification." />
  

   
  <meta property="og:description" content="Part of my project involves having a doorbell, I figured a simple doorbell whereby a visitor just presses a button and then it rings/ notify whoever is it the house, That's not really creative in my point of view. So I then decided why not have a doorbell that not...">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://localhost:4000/blog/2015/01/11/smart-doorbell-using-rpi-with-voice-and-email-notification.html" />
  <link rel="canonical" href="http://localhost:4000/blog/2015/01/11/smart-doorbell-using-rpi-with-voice-and-email-notification.html" />
  

  
  <meta property="og:image" content="http://localhost:4000/img/main.jpg" />
  


  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <meta name="twitter:creator" content="@" />

  
  <meta name="twitter:title" content="Smart Doorbell using RPi with voice and email notification." />
  

  
  <meta name="twitter:description" content="Part of my project involves having a doorbell, I figured a simple doorbell whereby a visitor just presses a button and then it rings/ notify whoever is it the house, That's not really creative in my point of view. So I then decided why not have a doorbell that not...">
  

  
  <meta name="twitter:image" content="http://localhost:4000/img/main.jpg" />
  

</head>


  <body>
    
    
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand" href="http://localhost:4000">Mpho Mphego</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            






<a href="//resume/MphoMphego.pdf">Resume</a>
          </li>
        
        
        
          <li>
            






<a href="/tags">Tags</a>
          </li>
        
        
      </ul>
    </div>

<!-- ALways use my avatar, irrespective of the post image -->
  <div class="avatar-container">
    <div class="avatar-img-border">
      <a href="http://localhost:4000 ">
        <img class="avatar-img" src="http://localhost:4000/img/av.png" />
     </a>
    </div>
  </div>

  </div>
</nav>

    <!-- TODO this file has become a mess, refactor it -->


<div class="intro-header"></div>


<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      

      <article role="main" class="blog-post">
        <p>Part of my project involves having a doorbell, I figured a simple doorbell whereby a visitor just presses a button and then it rings/ notify whoever is it the house, That's not really creative in my point of view.</p>
<p>So I then decided why not have a doorbell that not only rings when the button is pressed but also tell you someone is at the door and then sends you an email notification just in case you might be away(Not able to hear the bell.) as well as log the time that the button was pressed.</p>
<p>IDEA: It would be really cool if I had a USB Webcam that would take a picture of the person visiting and emails it.</p>
<p>first things first, we'll need to create the wav file ie TextToSpeech. Using this simple tool below.<br />
[sourcecode language="bash"]<br />
pico2wave -w DoorNotify.wav &quot;Someone is ringing the doorbell. Please Go Check&quot;<br />
[/sourcecode]</p>
<p>Next, create a python script that will watch the state of GPIO pin 18 on the RPi and take some action when the doorbell brings it to ‘HIGH’.</p>
<p>[sourcecode language="python"]<br />
#!/usr/bin/env python2.7<br />
__author__ = &quot;Mpho Mphego&quot;<br />
__version__ = &quot;$Revision: 1.1 $&quot;<br />
__description__ = &quot;Smart Doorbell Notifier with voice and email notification : Interrupt driven&quot;<br />
__date__ = &quot;$Date: 2015/01/11 02:23 $&quot;<br />
__copyright__ = &quot;Copyright (c) 2015 Mpho Mphego&quot;<br />
__url__ = &quot;mmphego.wordpress.com&quot;<br />
__license__ = &quot;Python&quot;</p>
<p>import RPi.GPIO as GPIO<br />
import time<br />
import os</p>
<p># Connect to Relay which will control the 12V Buzzer.<br />
led = 17 #GPIO0<br />
button = 18 #GPIO1</p>
<p>GPIO.setwarnings(False)<br />
GPIO.setmode(GPIO.BCM)<br />
GPIO.setup(led, GPIO.OUT)<br />
time.sleep(0.1)<br />
GPIO.output(led, False)</p>
<p># GPIO 1 set up as inputs, pulled up to avoid false detection.<br />
# Both ports are wired to connect to GND on button press.<br />
# So we'll be setting up falling edge detection for both<br />
GPIO.setup(button, GPIO.IN, pull_up_down=GPIO.PUD_UP)</p>
<p># define callback functions<br />
# this will run when an event are detected<br />
def buttonHandler(channel):<br />
    print &quot;falling edge detected on 18&quot;<br />
    GPIO.output(led, True)<br />
    time.sleep(1)<br />
    GPIO.output(led, False)<br />
    os.system(&quot;aplay /home/pi/Scripts/Smart_DoorBell/DoorNotify.wav&quot;)<br />
    os.system(&quot;python /home/pi/Scripts/Smart_DoorBell/DoorBellLogger.py&quot;)<br />
    time.sleep(1)<br />
    GPIO.output(led, True)<br />
    time.sleep(1)<br />
    GPIO.output(led, False)</p>
<p># when a falling edge is detected on port 1, regardless of whatever<br />
# else is happening in the program, the function buttonHandler will be run<br />
GPIO.add_event_detect(button, GPIO.FALLING, callback=buttonHandler, bouncetime=5000)</p>
<p>try:<br />
    print &quot;Waiting for button to be pressed&quot;<br />
    while True:<br />
        # To ease the CPU Usage have a 10s delay on while loop.<br />
        time.sleep(10)<br />
        continue<br />
except:<br />
    GPIO.cleanup()       # clean up GPIO on CTRL+C exit<br />
GPIO.cleanup()           # clean up GPIO on normal exit<br />
print &quot;Clean up by resetting all GPIO&quot;</p>
<p>[/sourcecode]</p>
<p>Now for the fun part, the email notification and data log.<br />
[sourcecode language="python"]</p>
<p>#!/usr/bin/env python<br />
__author__ = &quot;Mpho Mphego&quot;<br />
__description__ = &quot;Doorbell notifier time logger and email notifier.&quot;<br />
__version__ = &quot;$Revision: 1.0 $&quot;<br />
__date__ = &quot;$Date: 2015/01/10 02:09 $&quot;<br />
__copyright__ = &quot;Copyright (c) 2015 Mpho Mphego&quot;<br />
__license__ = &quot;Python&quot;</p>
<p>import time<br />
import datetime<br />
import os<br />
import smtplib<br />
from email.mime.text import MIMEText</p>
<p>#-----------------------Data Logger-----------------<br />
f=open('/home/pi/Logs/DoorBell_Data_Log.txt','a')<br />
now = datetime.datetime.now()<br />
timestamp = now.strftime(&quot;%H:%M on %Y/%m/%d&quot;)<br />
outstring1 = &quot; Someone was at the door at &quot; + str(timestamp)<br />
outstring2 = &quot;\n********************************************* \n &quot;<br />
outstring = outstring1 + outstring2<br />
f.write(outstring)<br />
f.close()</p>
<p># -----------------------Email Notifier----------------------<br />
# Replace with your details.<br />
USERNAME = &quot;*******@gmail.com&quot;<br />
PASSWORD = &quot;*********&quot;<br />
MAILTO  = &quot;******@gmail.com&quot;</p>
<p>if os.system(&quot;ping -c 1 www.google.com &gt;&gt; /dev/null 2&amp;&gt;1&quot;) == 0 :<br />
	print &quot;Sending Email Notification&quot;<br />
	msg = MIMEText('Someone is ringing the doorbell! \nGo Check!')<br />
	msg['Subject'] = 'Doorbell notification!'<br />
	msg['From'] = USERNAME<br />
	msg['To'] = MAILTO</p>
<p>	server = smtplib.SMTP('smtp.gmail.com:587')<br />
	server.ehlo_or_helo_if_needed()<br />
	server.starttls()<br />
	server.ehlo_or_helo_if_needed()<br />
	server.login(USERNAME,PASSWORD)<br />
	server.sendmail(USERNAME, MAILTO, msg.as_string())<br />
	server.quit()<br />
else:<br />
	print &quot;Unable to connect to Internet.&quot;</p>
<p>[/sourcecode]</p>
<p>To have this run upon booting, we need to edit /etc/rc.local (as root since this is the owner).</p>
<p>[sourcecode language="bash"]<br />
sudo nano /etc/rc.local<br />
[/sourcecode]</p>
<p>At the bottom, just above exit 0 we’ll add a call to our script.</p>
<p>[sourcecode language="bash"]<br />
python /home/pi/Scripts/Smart_DoorBell/WaitDoorbell.py<br />
[/sourcecode]</p>

      </article>

      
        <div class="blog-tags">
          Tags:
          
          
            <a href="/tags#doorbell">doorbell</a>
          
            <a href="/tags#email notification">email notification</a>
          
            <a href="/tags#GPIO">GPIO</a>
          
            <a href="/tags#python">python</a>
          
          
        </div>
      

      

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/blog/2014/12/19/rpi-enabling-i2c-communication.html" data-toggle="tooltip" data-placement="top" title="RPi enabling I2C communication">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="/blog/2015/01/19/android-webview-app-to-apache-server.html" data-toggle="tooltip" data-placement="top" title="Android WebView App (to Apache server)">Next Post &rarr;</a>
        </li>
        
      </ul>

      
        <div class="disqus-comments">
          <div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'mmphego-github-io';
        /* ensure that pages with query string get the same discussion */
            var url_parts = window.location.href.split("?");
            var disqus_url = url_parts[0];
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        </div>
      
    </div>
  </div>
</div>

    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="https://github.com/mmphego" title="GitHub">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">GitHub</span>
            </a>
          </li>
          
      
    
      
      
      
          <li>
            <a href="https://linkedin.com/in/mphomphego" title="LinkedIn">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">LinkedIn</span>
            </a>
          </li>
          
      
      
          <li>
            <a href="https://stackoverflow.com/users/6165344/mpho-mphego" title="StackOverflow">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">StackOverflow</span>
            </a>
          </li>
          
      
      
      
          <li>
            <a href="https://www.youtube.com/xxXMphoXxx" title="YouTube">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">YouTube</span>
            </a>
          </li>
          
      
      
      
          <li>
            <a href="/feed.xml" title="RSS">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">RSS</span>
            </a>
          </li>
          
      
      
      
        </ul>
        <p class="copyright text-muted">
      Mpho Mphego
      &nbsp;&bull;&nbsp;
      2018

      
      </p>
          <!-- Please don't remove this, keep my open source work credited :) -->
    <p class="theme-by text-muted">
      Awesome Theme by
      <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
    </p>
      </div>
    </div>
  </div>
</footer>
  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
        if (typeof jQuery == 'undefined') {
          document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
        }
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
  <script src="/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
  <script src="/js/main.js"></script>
    
  



	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-68808612-1', 'auto');
		ga('send', 'pageview');
	</script>
	<!-- End Google Analytics -->

  
  </body>
</html>
