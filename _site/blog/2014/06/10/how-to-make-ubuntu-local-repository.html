<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>How to make Ubuntu Local Repository</title>

  <meta name="author" content="Mpho Mphego" />
  <meta name="theme-color" content="#a50509">
  <meta name="description" content="Hi! I'm Mpho Mphego, a programmer, software developer. Loves to meet new people, connect, discuss, network and grow, mostly at software developers’ conferences, dev-fests and gaming meet-ups.">
  <meta name="keywords" content="Mpho , geek, linux, science, math, mathematics, raspberry pi, music, Internet of Things, research, android, ubuntu, python, docker">

  <!-- favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />

  <!-- MathJax -->
  <script type="text/x-mathjax-config">MathJax.Hub.Config({messageStyle: 'none',tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  <link rel="alternate" type="application/rss+xml" title="Mpho Mphego - Welcome to the geek side!" href="/feed.xml" />

  

  
    
      
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />

    
  

  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="How to make Ubuntu Local Repository" />
  

   
  <meta property="og:description" content="1. Open terminal. Install dpkg-dev ,apache2 and apt-mirror $ sudo su $ apt-get update &amp;amp;&amp;amp; apt-get upgrade $ apt-get install dpkg-dev apache2 apt-mirror 2. Create a directory where you will keep your packages. For this example, we'll use /usr/local/mydebs. $ mkdir -p /usr/local/mydebs 3. Now copy your packages into the...">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://localhost:4000/blog/2014/06/10/how-to-make-ubuntu-local-repository.html" />
  <link rel="canonical" href="http://localhost:4000/blog/2014/06/10/how-to-make-ubuntu-local-repository.html" />
  

  
  <meta property="og:image" content="http://localhost:4000/img/main.jpg" />
  


  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <meta name="twitter:creator" content="@" />

  
  <meta name="twitter:title" content="How to make Ubuntu Local Repository" />
  

  
  <meta name="twitter:description" content="1. Open terminal. Install dpkg-dev ,apache2 and apt-mirror $ sudo su $ apt-get update &amp;amp;&amp;amp; apt-get upgrade $ apt-get install dpkg-dev apache2 apt-mirror 2. Create a directory where you will keep your packages. For this example, we'll use /usr/local/mydebs. $ mkdir -p /usr/local/mydebs 3. Now copy your packages into the...">
  

  
  <meta name="twitter:image" content="http://localhost:4000/img/main.jpg" />
  

</head>


  <body>
    
    
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand" href="http://localhost:4000">Mpho Mphego</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            






<a href="//resume/MphoMphego.pdf">Resume</a>
          </li>
        
        
        
          <li>
            






<a href="/tags">Tags</a>
          </li>
        
        
      </ul>
    </div>

<!-- ALways use my avatar, irrespective of the post image -->
  <div class="avatar-container">
    <div class="avatar-img-border">
      <a href="http://localhost:4000 ">
        <img class="avatar-img" src="http://localhost:4000/img/av.png" />
     </a>
    </div>
  </div>

  </div>
</nav>

    <!-- TODO this file has become a mess, refactor it -->


<div class="intro-header"></div>


<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      

      <article role="main" class="blog-post">
        <p><strong>1. Open terminal.</strong></p>
<p><strong>Install dpkg-dev ,apache2 and apt-mirror</strong><br />
<code><br />
$ sudo su<br />
$ apt-get update &amp;&amp; apt-get upgrade<br />
$ apt-get install dpkg-dev apache2 apt-mirror<br />
</code><br />
<strong>2. Create a directory where you will keep your packages. For this example, we'll use /usr/local/mydebs.<br />
</strong><br />
<code>$ mkdir -p /usr/local/mydebs</code></p>
<p><strong>3. Now copy your packages into the directory you've just created.<br />
</strong></p>
<p><code>$ rsync -truv /var/cache/apt/archives/* /usr/local/mydebs</code></p>
<p>#tip: you can place that command on crontab to sync every week</p>
<p><strong>4. The Script update-mydebs<br />
</strong><br />
It's a simple three liner:<br />
<code><br />
$ mkdir -p ~/bin<br />
$ . ~/.bashrc<br />
$ nano update-mydebs</code></p>
<p><strong>copy the below code.<br />
</strong><code><br />
#! /bin/bash<br />
cd /usr/local/mydebs<br />
dpkg-scanpackages . /dev/null | gzip -9c &gt; Packages.gz<br />
</code><br />
Next, make the script executable:<br />
<code><br />
$ chmod u+x ~/bin/update-mydebs<br />
</code><br />
<strong>How the script works:<br />
</strong>dpkg-scanpackages looks at all the packages in mydebs, and the output is compressed and written to a file (Packages.gz) that apt-get update can read (see below for a reference that explains this in excruciating detail). /dev/null is an empty file; it is a substitute for an override file which holds some additional information about the packages, which in this case is not really needed. See deb-override(5) if you want to know about it.</p>
<p><strong>5. Update sources.list<br />
</strong><code><br />
$ echo "deb file:/usr/local/mydebs ./" | tee -a /etc/apt/sources.list<br />
</code><br />
<strong>6. Whenever you put a new deb in the mydebs directory, run<br />
</strong></p>
<p><code>$ update-mydebs<br />
$ apt-get update</code></p>
<p>Now your local packages can be manipulated with Synaptic, aptitude and the apt commands: apt-get, apt-cache, etc. When you attempt to apt-get install, any dependencies will be resolved for you, as long as they can be met.</p>
<p>Badly made packages will probably fail, but you won't have endured dpkg hell.</p>
<p><strong>7. Configuring apt-mirror</strong></p>
<p><code><br />
$ cp /etc/apt/mirror.list /etc/apt/mirror.list.orig<br />
$ cp /etc/apt/sources.list /etc/apt/sources.list.orig<br />
$ cp /etc/cron/apt-mirror /etc/cron/apt-mirror.orig<br />
$ cp /var/spool/apt-mirror/var/postmirror.sh /var/spool/apt-mirror/var/postmirror.sh.orig<br />
</code><br />
Now edit the files.</p>
<p><code><br />
$ echo "deb file:/usr/local/mydebs ./" | tee -a /etc/apt/mirror.list<br />
$ echo "clean deb file:/usr/local/mydebs ./" | tee -a /etc/apt/mirror.list<br />
</code></p>
<p>You can also remove or comment out the lines dealing with source code if you don't expect to need or use them. You can always add repositories later if you want. The time it takes to populate your mirror after adding something is less than the initial population of your mirror, so you can start with the minimum and add more later as the need arises.</p>
<p><strong>8. Now you can run apt-mirror for the first time. </strong></p>
<p>You might want to wait on this step since it will take a while for your mirror to build, overnight for example(depending on your internet speed).</p>
<p><code>$ apt-mirror</code></p>
<p>You'll see it working, but it will appear slow.<br />
Once the mirror is populated, link the repository to the web server:</p>
<p><strong>9. Linking repository to Webserver(apache2)</strong></p>
<p><code>ln -s /var/spool/apt-mirror/mirror/archive.ubuntu.com/ubuntu /var/www/<br />
ln -s /var/spool/apt-mirror/mirror/security.ubuntu.com/ubuntu /var/www/<br />
ln -s /usr/local/mydebs /var/www/</code></p>
<p><strong>Finally, make apt-mirror an automated task:(Not really necessary)</strong></p>
<p>remove the comment from the last line.<br />
<code>$ nano /etc/cron.d/apt-mirror</code></p>
<p><strong>10. Moving to the client side:</strong></p>
<p>Edit the sources.list file that will be used to access the mirror.</p>
<p><code>$ sudo nano /etc/apt/sources.list</code></p>
<p>The example below assumes using the mirror from the computer that hosts it.<br />
Using it from other computers on the network simply requires changing the IP address from 172.x.30.100 to whatever IP address is assigned to the mirror host(Server).</p>
<p><code>deb http://172.x.30.100/debs ./<br />
deb http://172.x.30.100/debs /</code><br />
<code><br />
deb http://172.x.30.100/ubuntu precise main restricted universe multiverse<br />
deb http://172.x.30.100/ubuntu precise-updates main restricted universe multiverse<br />
deb http://172.x.30.100/ubuntu precise-security main restricted universe multiverse</code></p>
<p><code>deb http://172.x.30.100/security precise main restricted universe multiverse<br />
deb http://172.x.30.100/security precise-updates main restricted universe multiverse<br />
deb http://172.x.30.100/security precise-security main restricted universe multiverse</code></p>
<p><strong>11. Update the source.list, run<br />
</strong></p>
<p><code>$ sudo su<br />
$ apt-get update &amp; apt-get upgrade</code></p>

      </article>

      

      

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/blog/2014/05/30/send-email-via-linux-terminalubuntu.html" data-toggle="tooltip" data-placement="top" title="Send email via Linux Terminal[Ubuntu]">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="/blog/2014/06/10/python-processing-gmail-imap-email.html" data-toggle="tooltip" data-placement="top" title="Python - processing GMail IMAP email">Next Post &rarr;</a>
        </li>
        
      </ul>

      
        <div class="disqus-comments">
          <div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'mmphego-github-io';
        /* ensure that pages with query string get the same discussion */
            var url_parts = window.location.href.split("?");
            var disqus_url = url_parts[0];
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        </div>
      
    </div>
  </div>
</div>

    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="https://github.com/mmphego" title="GitHub">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">GitHub</span>
            </a>
          </li>
          
      
    
      
      
      
          <li>
            <a href="https://linkedin.com/in/mphomphego" title="LinkedIn">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">LinkedIn</span>
            </a>
          </li>
          
      
      
          <li>
            <a href="https://stackoverflow.com/users/6165344/mpho-mphego" title="StackOverflow">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">StackOverflow</span>
            </a>
          </li>
          
      
      
      
          <li>
            <a href="https://www.youtube.com/xxXMphoXxx" title="YouTube">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">YouTube</span>
            </a>
          </li>
          
      
      
      
          <li>
            <a href="/feed.xml" title="RSS">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">RSS</span>
            </a>
          </li>
          
      
      
      
        </ul>
        <p class="copyright text-muted">
      Mpho Mphego
      &nbsp;&bull;&nbsp;
      2018

      
      </p>
          <!-- Please don't remove this, keep my open source work credited :) -->
    <p class="theme-by text-muted">
      Awesome Theme by
      <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
    </p>
      </div>
    </div>
  </div>
</footer>
  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
        if (typeof jQuery == 'undefined') {
          document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
        }
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
  <script src="/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
  <script src="/js/main.js"></script>
    
  



	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-68808612-1', 'auto');
		ga('send', 'pageview');
	</script>
	<!-- End Google Analytics -->

  
  </body>
</html>
