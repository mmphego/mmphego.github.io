---
layout: post
title: 'Why am I getting ''Errno(105): No buffer space available'' when subscribing
  to multicast addresses?'
date: 2017-06-28 12:04:34.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Linux/Ubuntu
- Tricks
tags: []
meta:
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '6562558568'
  publicize_linkedin_url: https://www.linkedin.com/updates?discuss=&scope=97183493&stype=M&topic=6285769693080928256&type=U&a=kn_r
  _publicize_done_16016023: '1'
  _wpas_done_15845576: '1'
  _publicize_failed_16257270: O:13:"Keyring_Error":2:{s:6:"errors";a:1:{s:21:"keyring-request-error";a:1:{i:0;a:6:{s:7:"headers";O:42:"Requests_Utility_CaseInsensitiveDictionary":1:{s:7:"
  _publicize_done_external: a:1:{s:7:"twitter";a:1:{i:16076855;s:56:"https://twitter.com/MphoMphego/status/880004009536479232";}}
  _publicize_done_16257272: '1'
  _wpas_done_16076855: '1'
  publicize_twitter_user: MphoMphego
  publicize_google_plus_url: https://plus.google.com/+MphoMphego/posts/ZAdVctyajyp
  _publicize_done_16966120: '1'
  _wpas_done_16750486: '1'
author:
  login: mpho112
  email: mpho112@gmail.com
  display_name: Mpho
  first_name: ''
  last_name: ''
---
<p>I have been experiencing multicast subscription when subscribing to more that 20 IP's via smcroute and python socket module. After vigorous googling I finally found a fix.</p>
<p><img class="alignnone size-full wp-image-1134" src="{{ site.baseurl }}/assets/screenshot_2017-06-28_11-59-55.png" alt="Screenshot_2017-06-28_11-59-55.png" width="1074" height="556" /></p>
<p>Linux OS, limit the number of multicast group memberships that a machine can belong to simultaneously. (A "multicast group membership" indicates that a machine is listening to messages for a specific multicast IP address. In other words, there is a limit on how many multicast IP addresses you can listen to.)</p>
<p>On Linux, in particular, the default limit is relatively small (only 20 on many standard kernels). However, this limit can be configured dynamically.</p>
<p>If you try to subscribe to too many multicast addresses at once, you may run into the error message below:</p>
<p>[sourcecode]<br />
daemon error: Warn: ADD MEMBERSHIP failed; Errno(105): No buffer space available<br />
22<br />
daemon error: Warn: ADD MEMBERSHIP failed; Errno(105): No buffer space available<br />
23<br />
daemon error: Warn: ADD MEMBERSHIP failed; Errno(105): No buffer space available<br />
[/sourcecode]<br />
The "Errno 105" in this message indicates that the errno value returned by the Linux network stack is 105, or ENOBUFS. This return value while adding a multicast address indicates that your machine is trying to be a member of too many multicast groups at the same time.</p>
<h3>Network Tuning</h3>
<p>Solution is to tune your kernel, backup your current sysclt.conf and replace contents with the ones below.</p>
<p><code>sudo vim /etc/sysctl.conf<br />
</code></p>
<p>[sourcecode language="bash"]<br />
# Bigger buffers (to make 40Gb more practical). These are maximums, but<br />
# the default is unaffected.<br />
net.core.wmem_max=268435456<br />
net.core.rmem_max=268435456<br />
net.core.netdev_max_backlog=10000</p>
<p># Avoids problems with multicast traffic arriving on non-default interfaces<br />
net.ipv4.conf.default.rp_filter=0<br />
net.ipv4.conf.all.rp_filter=0</p>
<p># Force IGMP v2 (required by CBF switch)<br />
net.ipv4.conf.all.force_igmp_version=2<br />
net.ipv4.conf.default.force_igmp_version=2</p>
<p># Increase the ARP cache table<br />
net.ipv4.neigh.default.gc_thresh3 = 4096<br />
net.ipv4.neigh.default.gc_thresh2 = 2048<br />
net.ipv4.neigh.default.gc_thresh1 = 1024</p>
<p># Increase number of multicast groups permitted<br />
net.ipv4.igmp_max_memberships = 1024<br />
[/sourcecode]</p>
<p>You can reload the configuration file by executing, <code>sudo sysctl -p</code> or by rebooting your system.</p>
